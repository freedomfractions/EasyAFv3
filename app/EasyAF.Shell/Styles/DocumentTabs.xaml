<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:controls="clr-namespace:EasyAF.Shell.Controls"
                    xmlns:core="clr-namespace:EasyAF.Core.Contracts;assembly=EasyAF.Core">

    <!-- Item template for a single document tab -->
    <DataTemplate x:Key="DocumentTabItemTemplate" DataType="{x:Type core:IDocument}">
        <Grid Margin="6,4">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="24"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Icon from OwnerModule.ModuleIcon -->
            <Image Grid.Column="0"
                   Width="16" Height="16"
                   VerticalAlignment="Center"
                   Source="{Binding OwnerModule.ModuleIcon}"
                   SnapsToDevicePixels="True"/>

            <!-- Title and modified indicator -->
            <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                <TextBlock Text="{Binding Title}"
                           Foreground="{DynamicResource TextPrimaryBrush}"
                           FontSize="12"/>
                <!-- Modified dot -->
                <Ellipse Width="6" Height="6" Fill="{DynamicResource WarningBrush}" Margin="6,0,0,0">
                    <Ellipse.Style>
                        <Style TargetType="Ellipse">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsDirty}" Value="True">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Ellipse.Style>
                </Ellipse>
            </StackPanel>

            <!-- Close button -->
            <Button Grid.Column="2"
                    Command="{x:Static controls:DocumentTabControl.CloseTabCommand}"
                    CommandParameter="{Binding}"
                    Background="Transparent"
                    BorderThickness="0"
                    ToolTip="Close"
                    Padding="4"
                    Width="20" Height="20">
                <Path Data="M 0,0 L 8,8 M 8,0 L 0,8"
                      StrokeThickness="1.5"
                      Stroke="{DynamicResource TextSecondaryBrush}"
                      Stretch="Uniform"/>
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Visibility" Value="Hidden"/>
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Visibility" Value="Visible"/>
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>
        </Grid>
    </DataTemplate>

    <!-- Item container style -->
    <Style x:Key="DocumentTabItemContainerStyle" TargetType="ListBoxItem">
        <Setter Property="Background" Value="{DynamicResource SecondaryBackgroundBrush}"/>
        <Setter Property="BorderBrush" Value="{DynamicResource ControlBorderBrush}"/>
        <Setter Property="BorderThickness" Value="0,0,0,1"/>
        <Setter Property="Padding" Value="4"/>
        <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
        <Setter Property="HorizontalAlignment" Value="Stretch"/>
        <Setter Property="ToolTip" Value="{Binding FilePath}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="ListBoxItem">
                    <Border Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}">
                        <ContentPresenter/>
                    </Border>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsSelected" Value="True">
                            <Setter Property="Background" Value="{DynamicResource HighlightSelectionBrush}"/>
                            <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                            <Setter Property="BorderThickness" Value="2,0,0,0"/>
                        </Trigger>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="{DynamicResource HighlightSelectionBrush}"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>

    <!-- Default style for the DocumentTabControl -->
    <Style TargetType="controls:DocumentTabControl">
        <Setter Property="ItemsPanel">
            <Setter.Value>
                <ItemsPanelTemplate>
                    <StackPanel Orientation="Vertical"/>
                </ItemsPanelTemplate>
            </Setter.Value>
        </Setter>
        <Setter Property="ItemTemplate" Value="{StaticResource DocumentTabItemTemplate}"/>
        <Setter Property="ItemContainerStyle" Value="{StaticResource DocumentTabItemContainerStyle}"/>
        <Setter Property="Background" Value="{DynamicResource SecondaryBackgroundBrush}"/>
        <Setter Property="BorderBrush" Value="{DynamicResource ControlBorderBrush}"/>
        <Setter Property="BorderThickness" Value="0,0,1,0"/>
        <Setter Property="MinWidth" Value="220"/>
    </Style>

</ResourceDictionary>
