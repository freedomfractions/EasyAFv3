<Window x:Class="EasyAF.Modules.Map.Views.MissingFilesDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Missing Referenced Files"
        Width="700" Height="500"
        MinWidth="600" MinHeight="400"
        WindowStartupLocation="CenterOwner"
        ShowInTaskbar="False"
        ResizeMode="CanResize">
    
    <Window.Resources>
        <!-- Status to color converter -->
        <Style x:Key="StatusTextStyle" TargetType="TextBlock">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Style.Triggers>
                <Trigger Property="Text" Value="Missing">
                    <Setter Property="Foreground" Value="#D32F2F"/>
                </Trigger>
                <Trigger Property="Text" Value="Resolved">
                    <Setter Property="Foreground" Value="#388E3C"/>
                </Trigger>
                <Trigger Property="Text" Value="Removed">
                    <Setter Property="Foreground" Value="#F57C00"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>
    
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="?? Missing Referenced Files"
                       FontSize="18"
                       FontWeight="SemiBold"
                       Foreground="{DynamicResource TextPrimaryBrush}"/>
            <TextBlock Text="Some files referenced by this map could not be found. You can browse for relocated files, remove missing references, or continue anyway."
                       TextWrapping="Wrap"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       Margin="0,8,0,0"/>
        </StackPanel>

        <!-- Summary Stats -->
        <Border Grid.Row="1"
                Background="{DynamicResource SecondaryBackgroundBrush}"
                BorderBrush="{DynamicResource ControlBorderBrush}"
                BorderThickness="1"
                CornerRadius="4"
                Padding="12"
                Margin="0,0,0,12">
            <WrapPanel>
                <TextBlock Margin="0,0,24,0">
                    <Run Text="Missing:" Foreground="{DynamicResource TextSecondaryBrush}"/>
                    <Run Text="{Binding RemainingCount, Mode=OneWay}" FontWeight="Bold" Foreground="#D32F2F"/>
                </TextBlock>
                <TextBlock Margin="0,0,24,0">
                    <Run Text="Resolved:" Foreground="{DynamicResource TextSecondaryBrush}"/>
                    <Run Text="{Binding ResolvedCount, Mode=OneWay}" FontWeight="Bold" Foreground="#388E3C"/>
                </TextBlock>
                <TextBlock>
                    <Run Text="Removed:" Foreground="{DynamicResource TextSecondaryBrush}"/>
                    <Run Text="{Binding RemovedCount, Mode=OneWay}" FontWeight="Bold" Foreground="#F57C00"/>
                </TextBlock>
            </WrapPanel>
        </Border>

        <!-- File List -->
        <DataGrid Grid.Row="2"
                  ItemsSource="{Binding MissingFiles}"
                  AutoGenerateColumns="False"
                  CanUserAddRows="False"
                  CanUserDeleteRows="False"
                  CanUserReorderColumns="False"
                  CanUserSortColumns="True"
                  SelectionMode="Single"
                  GridLinesVisibility="Horizontal"
                  HeadersVisibility="Column"
                  RowHeaderWidth="0"
                  Background="{DynamicResource ControlBackgroundBrush}"
                  BorderBrush="{DynamicResource ControlBorderBrush}"
                  BorderThickness="1">
            
            <DataGrid.Columns>
                <!-- File Name -->
                <DataGridTextColumn Header="File Name"
                                    Binding="{Binding FileName}"
                                    Width="200"
                                    IsReadOnly="True"/>
                
                <!-- Path -->
                <DataGridTextColumn Header="Original Path"
                                    Binding="{Binding OriginalPath}"
                                    Width="*"
                                    IsReadOnly="True"/>
                
                <!-- Status -->
                <DataGridTemplateColumn Header="Status" Width="100">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Status}"
                                       Style="{StaticResource StatusTextStyle}"
                                       VerticalAlignment="Center"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                
                <!-- Actions -->
                <DataGridTemplateColumn Header="Actions" Width="150">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Button Content="Browse..."
                                        Command="{Binding DataContext.BrowseCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                        CommandParameter="{Binding}"
                                        Padding="8,4"
                                        Margin="0,0,4,0">
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Status}" Value="Resolved">
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Status}" Value="Removed">
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                                
                                <Button Content="Remove"
                                        Command="{Binding DataContext.RemoveCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                        CommandParameter="{Binding}"
                                        Padding="8,4">
                                    <Button.Style>
                                        <Style TargetType="Button" BasedOn="{StaticResource BaseButtonStyle}">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Status}" Value="Resolved">
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                </DataTrigger>
                                                <DataTrigger Binding="{Binding Status}" Value="Removed">
                                                    <Setter Property="IsEnabled" Value="False"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                </Button>
                            </StackPanel>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <!-- Bulk Actions -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Margin="0,12,0,0">
            <Button Content="Remove All Missing"
                    Command="{Binding RemoveAllCommand}"
                    Style="{StaticResource BaseButtonStyle}"
                    Padding="12,6"/>
        </StackPanel>

        <!-- Dialog Buttons -->
        <StackPanel Grid.Row="4" 
                    Orientation="Horizontal" 
                    HorizontalAlignment="Right"
                    Margin="0,16,0,0">
            <Button Content="Continue"
                    Command="{Binding ContinueCommand}"
                    Style="{StaticResource AccentButtonStyle}"
                    Padding="24,8"
                    Margin="0,0,8,0"
                    IsDefault="True"/>
            <Button Content="Cancel"
                    Command="{Binding CancelCommand}"
                    Style="{StaticResource BaseButtonStyle}"
                    Padding="24,8"
                    IsCancel="True"/>
        </StackPanel>
    </Grid>
</Window>
