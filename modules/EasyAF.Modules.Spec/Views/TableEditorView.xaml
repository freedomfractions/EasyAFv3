<UserControl x:Class="EasyAF.Modules.Spec.Views.TableEditorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="{DynamicResource PrimaryBackgroundBrush}">
    
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/EasyAF.Modules.Spec;component/Styles/SpecEditorStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <!-- DataGrid Column Header Style -->
            <Style x:Key="ColumnEditorHeaderStyle" TargetType="DataGridColumnHeader">
                <Setter Property="Background" Value="{DynamicResource SecondaryBackgroundBrush}"/>
                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                <Setter Property="BorderBrush" Value="{DynamicResource ControlBorderBrush}"/>
                <Setter Property="BorderThickness" Value="0,0,1,1"/>
                <Setter Property="Padding" Value="8,4"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="HorizontalContentAlignment" Value="Left"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
            </Style>
            
            <!-- DataGrid Row Style -->
            <Style x:Key="ColumnEditorRowStyle" TargetType="DataGridRow">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                <Style.Triggers>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Background" Value="{DynamicResource HighlightSelectionBrush}"/>
                    </Trigger>
                    <Trigger Property="IsMouseOver" Value="True">
                        <Setter Property="Background" Value="{DynamicResource SecondaryBackgroundBrush}"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
            
            <!-- THEME FIX: DataGrid Cell Style for proper theming -->
            <Style x:Key="ColumnEditorCellStyle" TargetType="DataGridCell">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                <Setter Property="BorderBrush" Value="Transparent"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="DataGridCell">
                            <Border Background="{TemplateBinding Background}"
                                    BorderBrush="{TemplateBinding BorderBrush}"
                                    BorderThickness="{TemplateBinding BorderThickness}"
                                    Padding="{TemplateBinding Padding}">
                                <ContentPresenter VerticalAlignment="Center"/>
                            </Border>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
                <Style.Triggers>
                    <Trigger Property="IsSelected" Value="True">
                        <Setter Property="Background" Value="{DynamicResource HighlightSelectionBrush}"/>
                        <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                    </Trigger>
                </Style.Triggers>
            </Style>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>    <!-- Column list -->
            <RowDefinition Height="16"/>   <!-- Spacer -->
            <RowDefinition Height="Auto"/> <!-- Column properties -->
        </Grid.RowDefinitions>
        
        <!-- Column List Section -->
        <GroupBox Grid.Row="0" 
                  Header="Columns" 
                  Foreground="{DynamicResource TextPrimaryBrush}"
                  BorderBrush="{DynamicResource ControlBorderBrush}">
            <Grid Margin="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Toolbar -->
                    <RowDefinition Height="*"/>    <!-- DataGrid -->
                </Grid.RowDefinitions>
                
                <!-- Toolbar -->
                <ToolBar Grid.Row="0" 
                         Background="{DynamicResource SecondaryBackgroundBrush}"
                         BorderBrush="{DynamicResource ControlBorderBrush}">
                    <Button Content="Add Column" 
                            Command="{Binding AddColumnCommand}"
                            Style="{StaticResource ToolBarButtonStyle}"/>
                    <Button Content="Remove" 
                            Command="{Binding RemoveColumnCommand}"
                            Style="{StaticResource ToolBarButtonStyle}"/>
                    <Separator/>
                    <Button Content="▲" 
                            Command="{Binding MoveColumnUpCommand}"
                            ToolTip="Move Up"
                            Style="{StaticResource ToolBarButtonStyle}"
                            Width="32"/>
                    <Button Content="▼" 
                            Command="{Binding MoveColumnDownCommand}"
                            ToolTip="Move Down"
                            Style="{StaticResource ToolBarButtonStyle}"
                            Width="32"/>
                    <Separator/>
                    <Button Content="Edit..." 
                            Command="{Binding EditColumnCommand}"
                            Style="{StaticResource ToolBarButtonStyle}"/>
                </ToolBar>
                
                <!-- Columns DataGrid -->
                <DataGrid Grid.Row="1" 
                          ItemsSource="{Binding Columns}"
                          SelectedItem="{Binding SelectedColumn}"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          CanUserDeleteRows="False"
                          HeadersVisibility="Column"
                          Background="{DynamicResource ControlBackgroundBrush}"
                          Foreground="{DynamicResource TextPrimaryBrush}"
                          BorderBrush="{DynamicResource ControlBorderBrush}"
                          BorderThickness="1"
                          Margin="0,8,0,0"
                          ColumnHeaderStyle="{StaticResource ColumnEditorHeaderStyle}"
                          RowStyle="{StaticResource ColumnEditorRowStyle}"
                          CellStyle="{StaticResource ColumnEditorCellStyle}"
                          GridLinesVisibility="Horizontal"
                          HorizontalGridLinesBrush="{DynamicResource ControlBorderBrush}"
                          RowBackground="{DynamicResource ControlBackgroundBrush}"
                          AlternatingRowBackground="{DynamicResource PrimaryBackgroundBrush}"
                          ScrollViewer.VerticalScrollBarVisibility="Auto"
                          ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                          ScrollViewer.CanContentScroll="False">
                    <DataGrid.Columns>
                        <!-- Order Column -->
                        <DataGridTextColumn Header="#" 
                                            Binding="{Binding OrderIndex}" 
                                            Width="40"
                                            IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        
                        <!-- Column Header - EDITABLE -->
                        <DataGridTextColumn Header="Column Header" 
                                            Binding="{Binding ColumnHeader, UpdateSourceTrigger=PropertyChanged}" 
                                            Width="200">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                            <DataGridTextColumn.EditingElementStyle>
                                <Style TargetType="TextBox">
                                    <Setter Property="Background" Value="{DynamicResource ControlBackgroundBrush}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                    <Setter Property="BorderBrush" Value="{DynamicResource ControlBorderBrush}"/>
                                    <Setter Property="CaretBrush" Value="{DynamicResource TextPrimaryBrush}"/>
                                </Style>
                            </DataGridTextColumn.EditingElementStyle>
                        </DataGridTextColumn>
                        
                        <!-- Property Paths - BUTTON to open picker -->
                        <DataGridTemplateColumn Header="Property Paths" Width="250">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <TextBlock Text="{Binding PropertyPathsDisplay}" 
                                               Foreground="{DynamicResource TextSecondaryBrush}"
                                               TextTrimming="CharacterEllipsis"
                                               ToolTip="{Binding PropertyPathsDisplay}"
                                               Cursor="Hand"
                                               MouseLeftButtonDown="PropertyPaths_MouseLeftButtonDown"/>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                        
                        <!-- Width Percent - EDITABLE -->
                        <DataGridTextColumn Header="Width %" 
                                            Binding="{Binding WidthPercent, UpdateSourceTrigger=PropertyChanged}" 
                                            Width="80">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="HorizontalAlignment" Value="Center"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                            <DataGridTextColumn.EditingElementStyle>
                                <Style TargetType="TextBox">
                                    <Setter Property="Background" Value="{DynamicResource ControlBackgroundBrush}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                    <Setter Property="BorderBrush" Value="{DynamicResource ControlBorderBrush}"/>
                                    <Setter Property="CaretBrush" Value="{DynamicResource TextPrimaryBrush}"/>
                                    <Setter Property="HorizontalContentAlignment" Value="Center"/>
                                </Style>
                            </DataGridTextColumn.EditingElementStyle>
                        </DataGridTextColumn>
                        
                        <!-- Format - EDITABLE -->
                        <DataGridTextColumn Header="Format" 
                                            Binding="{Binding FormatDisplay, UpdateSourceTrigger=PropertyChanged}" 
                                            Width="*">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock">
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                </Style>
                            </DataGridTextColumn.ElementStyle>
                            <DataGridTextColumn.EditingElementStyle>
                                <Style TargetType="TextBox">
                                    <Setter Property="Background" Value="{DynamicResource ControlBackgroundBrush}"/>
                                    <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                                    <Setter Property="BorderBrush" Value="{DynamicResource ControlBorderBrush}"/>
                                    <Setter Property="CaretBrush" Value="{DynamicResource TextPrimaryBrush}"/>
                                </Style>
                            </DataGridTextColumn.EditingElementStyle>
                        </DataGridTextColumn>
                    </DataGrid.Columns>
                </DataGrid>
                
                <!-- Empty State Overlay -->
                <Border Grid.Row="1"
                        Background="{DynamicResource WindowBackgroundBrush}"
                        Opacity="0.95"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Center"
                        CornerRadius="8"
                        Padding="32,24"
                        BorderBrush="{DynamicResource ControlBorderBrush}"
                        BorderThickness="2"
                        Margin="10"
                        IsHitTestVisible="False">
                    <Border.Style>
                        <Style TargetType="Border">
                            <Setter Property="Visibility" Value="Collapsed"/>
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Columns.Count}" Value="0">
                                    <Setter Property="Visibility" Value="Visible"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Border.Style>
                    
                    <StackPanel MaxWidth="350">
                        <!-- Icon -->
                        <TextBlock Text="&#xE8EF;"
                                   FontFamily="Segoe MDL2 Assets"
                                   FontSize="48"
                                   HorizontalAlignment="Center"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   Margin="0,0,0,16"/>
                        
                        <!-- Title -->
                        <TextBlock Text="No Columns Defined"
                                   FontSize="16"
                                   FontWeight="SemiBold"
                                   HorizontalAlignment="Center"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   Margin="0,0,0,8"/>
                        
                        <!-- Message -->
                        <TextBlock TextWrapping="Wrap"
                                   TextAlignment="Center"
                                   Foreground="{DynamicResource TextSecondaryBrush}"
                                   Margin="0,0,0,16">
                            <Run Text="Click"/>
                            <Run Text="Add Column" FontWeight="Bold"/>
                            <Run Text="above to create your first column. Columns define what data appears in this report or label."/>
                        </TextBlock>
                    </StackPanel>
                </Border>
            </Grid>
        </GroupBox>
        
        <!-- Column Properties Section (future: show properties of selected column) -->
        <GroupBox Grid.Row="2" 
                  Header="Column Properties" 
                  Foreground="{DynamicResource TextPrimaryBrush}"
                  BorderBrush="{DynamicResource ControlBorderBrush}"
                  MaxHeight="200">
            <TextBlock Text="Select a column above to edit its properties. (Property editor deferred to future enhancement)"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       FontStyle="Italic"
                       Margin="8"
                       TextWrapping="Wrap"/>
        </GroupBox>
    </Grid>
</UserControl>
