<Window x:Class="EasyAF.Modules.Spec.Views.Dialogs.FilterEditorDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:EasyAF.Modules.Spec.Converters"
        Title="Edit Filter Rule"
        Width="600"
        Height="600"
        WindowStartupLocation="CenterOwner"
        ResizeMode="CanResize"
        MinWidth="500"
        MinHeight="400"
        MaxHeight="800"
        SizeToContent="Height"
        Background="{DynamicResource WindowBackgroundBrush}"
        ShowInTaskbar="False">
    
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/EasyAF.Modules.Spec;component/Styles/SpecEditorStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            
            <converters:NullToBooleanConverter x:Key="NullToBooleanConverter"/>
            
            <Style x:Key="SectionHeaderStyle" TargetType="TextBlock">
                <Setter Property="FontSize" Value="13"/>
                <Setter Property="FontWeight" Value="SemiBold"/>
                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                <Setter Property="Margin" Value="0,0,0,8"/>
            </Style>
            
            <Style x:Key="LabelStyle" TargetType="TextBlock">
                <Setter Property="Foreground" Value="{DynamicResource TextPrimaryBrush}"/>
                <Setter Property="VerticalAlignment" Value="Center"/>
                <Setter Property="Margin" Value="0,0,8,0"/>
            </Style>
        </ResourceDictionary>
    </Window.Resources>
    
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="*"/>    <!-- Content -->
            <RowDefinition Height="Auto"/> <!-- Buttons -->
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Margin="0,0,0,16">
            <TextBlock Text="Filter Rule Configuration"
                       FontSize="16"
                       FontWeight="SemiBold"
                       Foreground="{DynamicResource TextPrimaryBrush}"
                       Margin="0,0,0,4"/>
            <TextBlock Text="Define criteria to include or exclude rows from this table."
                       FontSize="11"
                       Foreground="{DynamicResource TextSecondaryBrush}"/>
        </StackPanel>
        
        <!-- Content -->
        <ScrollViewer Grid.Row="1" 
                      VerticalScrollBarVisibility="Auto"
                      Margin="0,0,8,0">
            <StackPanel>
                <!-- Property Path Section -->
                <TextBlock Text="Property to Filter On"
                           Style="{StaticResource SectionHeaderStyle}"/>
                
                <Grid Margin="0,0,0,16">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <TextBox Grid.Column="0"
                             Text="{Binding PropertyPath, UpdateSourceTrigger=PropertyChanged}"
                             IsReadOnly="True"
                             Background="{DynamicResource ControlBackgroundBrush}"
                             Foreground="{DynamicResource TextPrimaryBrush}"
                             BorderBrush="{DynamicResource ControlBorderBrush}"
                             Padding="6"
                             ToolTip="Property path to evaluate (e.g., TripUnit.Adjustable)"/>
                    
                    <Button Grid.Column="1"
                            Content="Browse..."
                            Command="{Binding BrowsePropertyCommand}"
                            Margin="8,0,0,0"
                            Padding="12,6"
                            Background="{DynamicResource ControlBackgroundBrush}"
                            Foreground="{DynamicResource TextPrimaryBrush}"
                            BorderBrush="{DynamicResource ControlBorderBrush}"/>
                </Grid>
                
                <!-- Operator Section -->
                <TextBlock Text="Comparison Operator"
                           Style="{StaticResource SectionHeaderStyle}"/>
                
                <ComboBox SelectedValue="{Binding Operator, UpdateSourceTrigger=PropertyChanged}"
                          DisplayMemberPath="DisplayName"
                          SelectedValuePath="Value"
                          ItemsSource="{Binding AvailableOperators}"
                          Background="{DynamicResource ControlBackgroundBrush}"
                          Foreground="{DynamicResource TextPrimaryBrush}"
                          BorderBrush="{DynamicResource ControlBorderBrush}"
                          Padding="6"
                          Margin="0,0,0,16"/>
                
                <!-- Comparison Value Section -->
                <TextBlock Text="Compare To"
                           Style="{StaticResource SectionHeaderStyle}"/>
                
                <Grid Margin="0,0,0,16">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="8"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Mode Selection -->
                    <StackPanel Grid.Row="0" Orientation="Horizontal">
                        <RadioButton Content="Literal Value"
                                     IsChecked="{Binding IsValueMode}"
                                     Margin="0,0,16,0"
                                     Foreground="{DynamicResource TextPrimaryBrush}"/>
                        <RadioButton Content="Another Property"
                                     IsChecked="{Binding IsPropertyMode}"
                                     Foreground="{DynamicResource TextPrimaryBrush}"/>
                    </StackPanel>
                    
                    <!-- Value Input (visible when IsValueMode) -->
                    <TextBox Grid.Row="2"
                             Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                             Background="{DynamicResource ControlBackgroundBrush}"
                             Foreground="{DynamicResource TextPrimaryBrush}"
                             BorderBrush="{DynamicResource ControlBorderBrush}"
                             Padding="6"
                             ToolTip="Literal value to compare against (e.g., 'true', '480', 'ABC')">
                        <TextBox.Style>
                            <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsValueMode}" Value="True">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                    
                    <!-- Property Input (visible when IsPropertyMode) -->
                    <Grid Grid.Row="2">
                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsPropertyMode}" Value="True">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>
                        
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBox Grid.Column="0"
                                 Text="{Binding RightPropertyPath, UpdateSourceTrigger=PropertyChanged}"
                                 IsReadOnly="True"
                                 Background="{DynamicResource ControlBackgroundBrush}"
                                 Foreground="{DynamicResource TextPrimaryBrush}"
                                 BorderBrush="{DynamicResource ControlBorderBrush}"
                                 Padding="6"
                                 ToolTip="Property to compare against (e.g., RatingKA, DutyKA)"/>
                        
                        <Button Grid.Column="1"
                                Content="Browse..."
                                Command="{Binding BrowseRightPropertyCommand}"
                                Margin="8,0,0,0"
                                Padding="12,6"
                                Background="{DynamicResource ControlBackgroundBrush}"
                                Foreground="{DynamicResource TextPrimaryBrush}"
                                BorderBrush="{DynamicResource ControlBorderBrush}"/>
                    </Grid>
                </Grid>
                
                <!-- Options Section -->
                <TextBlock Text="Options"
                           Style="{StaticResource SectionHeaderStyle}"/>
                
                <StackPanel Margin="0,0,0,16">
                    <CheckBox Content="Numeric comparison (parse values as numbers)"
                              IsChecked="{Binding Numeric, UpdateSourceTrigger=PropertyChanged}"
                              Margin="0,0,0,8"
                              Foreground="{DynamicResource TextPrimaryBrush}"/>
                    
                    <CheckBox Content="Ignore case (for text comparisons)"
                              IsChecked="{Binding IgnoreCase, UpdateSourceTrigger=PropertyChanged}"
                              Foreground="{DynamicResource TextPrimaryBrush}">
                        <CheckBox.Style>
                            <Style TargetType="CheckBox" BasedOn="{StaticResource {x:Type CheckBox}}">
                                <Setter Property="IsEnabled" Value="True"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Numeric}" Value="True">
                                        <Setter Property="IsEnabled" Value="False"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </CheckBox.Style>
                    </CheckBox>
                </StackPanel>
                
                <!-- Summary Section -->
                <Border Background="{DynamicResource SecondaryBackgroundBrush}"
                        BorderBrush="{DynamicResource ControlBorderBrush}"
                        BorderThickness="1"
                        CornerRadius="4"
                        Padding="12"
                        Margin="0,8,0,0">
                    <StackPanel>
                        <TextBlock Text="Filter Summary"
                                   FontWeight="SemiBold"
                                   Foreground="{DynamicResource TextPrimaryBrush}"
                                   Margin="0,0,0,6"/>
                        <TextBlock Text="{Binding Summary}"
                                   TextWrapping="Wrap"
                                   Foreground="{DynamicResource TextSecondaryBrush}"/>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>
        
        <!-- Buttons -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,16,0,0">
            <Button Content="OK"
                    Command="{Binding OkCommand}"
                    IsDefault="True"
                    Style="{StaticResource AccentButtonStyle}"
                    MinWidth="80"
                    Padding="12,6"
                    Margin="0,0,8,0"/>
            <Button Content="Cancel"
                    Command="{Binding CancelCommand}"
                    IsCancel="True"
                    Style="{StaticResource BaseButtonStyle}"
                    MinWidth="80"
                    Padding="12,6"/>
        </StackPanel>
    </Grid>
</Window>
