<Window x:Class="EasyAF.Modules.Project.Views.ScenarioSelectionDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Select Scenarios to Import"
        Width="600" Height="500"
        WindowStartupLocation="CenterOwner"
        Background="{DynamicResource PrimaryBackgroundBrush}"
        Foreground="{DynamicResource TextPrimaryBrush}"
        ResizeMode="CanResize"
        ShowInTaskbar="False">
    
    <Window.Resources>
        <!-- Checkbox style for ListBox items -->
        <Style x:Key="ScenarioCheckBoxStyle" TargetType="CheckBox">
            <Setter Property="Margin" Value="8,4"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
        </Style>
    </Window.Resources>
    
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <TextBlock Grid.Row="0"
                   Text="Select which scenarios to import from the file:"
                   FontSize="14"
                   FontWeight="SemiBold"
                   Margin="0,0,0,12"/>

        <!-- Selection Controls -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,8">
            <Button Content="Select All"
                    Command="{Binding SelectAllCommand}"
                    Style="{StaticResource BaseButtonStyle}"
                    Padding="12,6"
                    Margin="0,0,8,0"/>
            
            <Button Content="Deselect All"
                    Command="{Binding DeselectAllCommand}"
                    Style="{StaticResource BaseButtonStyle}"
                    Padding="12,6"
                    Margin="0,0,16,0"/>

            <TextBlock Text="{Binding SelectionSummary}"
                       VerticalAlignment="Center"
                       Foreground="{DynamicResource TextSecondaryBrush}"
                       FontSize="12"/>
        </StackPanel>

        <!-- Scenario List -->
        <Border Grid.Row="2"
                BorderBrush="{DynamicResource ControlBorderBrush}"
                BorderThickness="1"
                Background="{DynamicResource ControlBackgroundBrush}"
                CornerRadius="4">
            <ListBox ItemsSource="{Binding Scenarios}"
                     Background="Transparent"
                     BorderThickness="0"
                     Padding="8"
                     HorizontalContentAlignment="Stretch">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- Selection Checkbox -->
                            <CheckBox Grid.Column="0"
                                      IsChecked="{Binding IsSelected}"
                                      VerticalAlignment="Center"
                                      Margin="0,0,8,0"/>

                            <!-- Scenario Info -->
                            <StackPanel Grid.Column="1">
                                <!-- Editable scenario name -->
                                <TextBox Text="{Binding DisplayName, UpdateSourceTrigger=PropertyChanged}"
                                         FontWeight="SemiBold"
                                         BorderThickness="0"
                                         Background="Transparent"
                                         Foreground="{DynamicResource TextPrimaryBrush}"
                                         Padding="4,2"
                                         Margin="0,0,0,2">
                                    <TextBox.Style>
                                        <Style TargetType="TextBox" BasedOn="{StaticResource {x:Type TextBox}}">
                                            <Setter Property="BorderThickness" Value="0"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="BorderBrush" Value="{DynamicResource ControlBorderHoverBrush}"/>
                                                    <Setter Property="BorderThickness" Value="1"/>
                                                </Trigger>
                                                <Trigger Property="IsFocused" Value="True">
                                                    <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                                                    <Setter Property="BorderThickness" Value="1"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBox.Style>
                                </TextBox>

                                <!-- Metadata row -->
                                <StackPanel Orientation="Horizontal">
                                    <!-- Entry count -->
                                    <TextBlock Foreground="{DynamicResource TextSecondaryBrush}"
                                               FontSize="11"
                                               Margin="4,0,12,0">
                                        <Run Text="{Binding EntryCount, StringFormat='{}{0} entries', Mode=OneWay}"/>
                                    </TextBlock>

                                    <!-- Conflict warning -->
                                    <TextBlock Foreground="#FFA500"
                                               FontSize="11"
                                               FontWeight="SemiBold"
                                               Margin="0,0,12,0">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HasConflict}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                        <Run Text="? Scenario exists (will be replaced)"/>
                                    </TextBlock>

                                    <!-- Rename indicator -->
                                    <TextBlock Foreground="{DynamicResource AccentBrush}"
                                               FontSize="11"
                                               FontStyle="Italic">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding HasRename}" Value="True">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                        <Run Text="(renamed from: "/>
                                        <Run Text="{Binding OriginalName, Mode=OneWay}"/>
                                        <Run Text=")"/>
                                    </TextBlock>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Border>

        <!-- Help Text -->
        <StackPanel Grid.Row="3" Margin="0,12,0,0">
            <TextBlock Foreground="{DynamicResource TextSecondaryBrush}"
                       FontSize="11"
                       TextWrapping="Wrap"
                       Margin="0,0,0,4">
                <Run FontWeight="SemiBold" Text="Tip:"/>
                <Run Text="Click scenario names to rename them before importing."/>
            </TextBlock>
            <TextBlock Foreground="{DynamicResource TextSecondaryBrush}"
                       FontSize="11"
                       TextWrapping="Wrap"
                       Margin="0,0,0,4">
                <Run FontWeight="SemiBold" Text="Warning:"/>
                <Run Text="Scenarios marked with ? already exist and will be replaced."/>
            </TextBlock>
        </StackPanel>

        <!-- Dialog Buttons -->
        <StackPanel Grid.Row="4"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,16,0,0">
            <Button Content="OK"
                    IsDefault="True"
                    Click="OkButton_Click"
                    Style="{StaticResource AccentButtonStyle}"
                    Padding="24,8"
                    Margin="0,0,8,0"
                    MinWidth="80"/>
            
            <Button Content="Cancel"
                    IsCancel="True"
                    Style="{StaticResource BaseButtonStyle}"
                    Padding="24,8"
                    MinWidth="80"/>
        </StackPanel>
    </Grid>
</Window>
